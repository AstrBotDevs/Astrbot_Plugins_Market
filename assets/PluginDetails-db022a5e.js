import{d as T}from"./markdown-75d73743.js";import{g as v,w as b,G as S,n as G,o as f,c as w,a as y,L as B,Q as x,k as a,j as o,u as i,q as I,A as k,N as D,t as g,v as R,X as L,z as A,ad as O,ae as q,R as j,E as H}from"./vendor-6e161c91.js";import{_ as N,a as U}from"./index-7de489ca.js";import{E as V,f as W}from"./icons-889b0855.js";const Q={class:"plugin-comment"},X={__name:"PluginComment",props:{repo:{type:String,required:!0},theme:{type:String,default:"light"},pluginName:{type:String,required:!0}},setup(r){const p=r,d=v(null);function E(){if(!d.value)return;const l=d.value.querySelector("iframe");l&&l.remove();const e=document.createElement("script");e.src="https://giscus.app/client.js",e.setAttribute("data-repo","IGCrystal-NEO/Astrbot_Plugins_Market"),e.setAttribute("data-repo-id","R_kgDOPRLyzg"),e.setAttribute("data-category","Ideas"),e.setAttribute("data-category-id","DIC_kwDOPRLyzs4CthUw"),e.setAttribute("data-mapping","specific"),e.setAttribute("data-term",`plugin:${p.pluginName}`),e.setAttribute("data-strict","1"),e.setAttribute("data-reactions-enabled","1"),e.setAttribute("data-emit-metadata","0"),e.setAttribute("data-input-position","bottom"),e.setAttribute("data-theme",p.theme==="dark"?"dark_tritanopia":"light_tritanopia"),e.setAttribute("data-lang","zh-CN"),e.setAttribute("data-loading","lazy"),e.crossOrigin="anonymous",e.async=!0,d.value.appendChild(e)}b(()=>p.theme,()=>{E()});const c=l=>{const e=document.querySelector(".giscus-frame");e&&e.contentWindow.postMessage({giscus:{setConfig:{theme:l==="dark"?"dark_tritanopia":"light_tritanopia"}}},"https://giscus.app")};return S(()=>{E()}),b(()=>p.theme,l=>{G(()=>{c(l)})},{immediate:!1}),(l,e)=>(f(),w("div",Q,[e[0]||(e[0]=y("div",{class:"plugin-comment__header"},null,-1)),y("div",{class:"giscus",ref_key:"giscusRef",ref:d},null,512)]))}},F=N(X,[["__scopeId","data-v-39203d0b"]]);const J={class:"plugin-details__header"},K={class:"plugin-details__content"},Y={key:0,class:"readme-loading"},Z={key:1,class:"readme-error"},ee=["innerHTML"],te={class:"plugin-details__footer"},se={__name:"PluginDetails",props:{show:Boolean,plugin:Object},emits:["update:show"],setup(r,{emit:p}){const d=r,E=p,c=v(d.show),l=v(!1),e=v(!1),$=v(""),z=U(),{isDarkMode:C}=B(z);b(()=>d.show,u=>{c.value=u}),b(c,u=>{E("update:show",u),u&&M()});const P=u=>{u&&window.open(u,"_blank")};async function M(){var u;if((u=d.plugin)!=null&&u.repo){l.value=!0,e.value=!1;try{const[t,n]=d.plugin.repo.split("/").slice(-2);let s,m="";console.log(`尝试获取 main 分支的 README: ${t}/${n}`);try{if(s=await fetch(`https://github.wenturc.com/${t}/${n}/main/README.md`,{method:"GET",headers:{Accept:"text/plain"},timeout:1e4}),s.ok)m=await s.text(),console.log(`成功从 main 分支获取 README: ${t}/${n}`);else throw console.log(`main 分支返回状态: ${s.status}`),new Error(`Main branch returned ${s.status}`)}catch(_){console.log(`main 分支失败，尝试 master 分支: ${_.message}`);try{if(s=await fetch(`https://github.wenturc.com/${t}/${n}/master/README.md`,{method:"GET",headers:{Accept:"text/plain"},timeout:1e4}),s.ok)m=await s.text(),console.log(`成功从 master 分支获取 README: ${t}/${n}`);else throw console.log(`master 分支返回状态: ${s.status}`),new Error(`Master branch returned ${s.status}`)}catch(h){throw console.log(`master 分支也失败: ${h.message}`),new Error(`无法从 main 和 master 分支获取 README: ${_.message}, ${h.message}`)}}if(!m)throw new Error("README 内容为空");$.value=T(m)}catch(t){console.error("Error fetching README:",t),e.value=!0}finally{l.value=!1}}}return(u,t)=>(f(),x(i(H),{show:c.value,"onUpdate:show":t[2]||(t[2]=n=>c.value=n),"mask-closable":!0,preset:"card",class:"plugin-details",style:{"max-width":"900px",width:"90%"},bordered:!1},{header:a(()=>[y("div",J,[o(i(I),{class:"plugin-details__title"},{default:a(()=>[o(i(k),{align:"center",size:12},{default:a(()=>{var n;return[o(i(D),{size:"24"},{default:a(()=>[o(i(V))]),_:1}),g(" "+R((n=r.plugin)==null?void 0:n.name)+" ",1),o(i(L),{type:"success",size:"small",bordered:!1},{default:a(()=>{var s,m,_,h;return[g(R((m=(s=r.plugin)==null?void 0:s.version)!=null&&m.startsWith("v")?(_=r.plugin)==null?void 0:_.version:"v"+((h=r.plugin)==null?void 0:h.version)),1)]}),_:1})]}),_:1})]),_:1})])]),footer:a(()=>[y("div",te,[o(i(k),{justify:"end",size:12},{default:a(()=>[o(i(A),{secondary:"",type:"primary",onClick:t[0]||(t[0]=n=>{var s;return P((s=r.plugin)==null?void 0:s.repo)})},{icon:a(()=>[o(i(D),null,{default:a(()=>[o(i(W))]),_:1})]),default:a(()=>[t[5]||(t[5]=g(" 查看仓库 ",-1))]),_:1,__:[5]}),o(i(A),{type:"primary",onClick:t[1]||(t[1]=n=>c.value=!1)},{default:a(()=>t[6]||(t[6]=[g(" 关闭 ",-1)])),_:1,__:[6]})]),_:1})])]),default:a(()=>[y("div",K,[o(i(k),{vertical:"",size:"large"},{default:a(()=>{var n,s;return[l.value?(f(),w("div",Y,[o(i(O),{size:"medium"},{description:a(()=>t[3]||(t[3]=[g(" 正在加载 README... ",-1)])),_:1})])):e.value?(f(),w("div",Z,[o(i(q),{description:"加载 README 失败"},{extra:a(()=>[o(i(A),{size:"small",onClick:M},{default:a(()=>t[4]||(t[4]=[g(" 重试 ",-1)])),_:1,__:[4]})]),_:1})])):(f(),w("div",{key:2,class:"markdown-content",innerHTML:$.value},null,8,ee)),(n=r.plugin)!=null&&n.repo?(f(),x(F,{key:3,repo:r.plugin.repo,theme:i(C)?"dark":"light","plugin-name":(s=r.plugin)==null?void 0:s.name},null,8,["repo","theme","plugin-name"])):j("",!0)]}),_:1})])]),_:1},8,["show"]))}},re=N(se,[["__scopeId","data-v-be45808c"]]);export{re as default};
