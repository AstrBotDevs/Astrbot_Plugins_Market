import{d as H}from"./markdown-75d73743.js";import{g as m,L as C,w as D,o as _,Q as G,k as t,a as E,j as a,u as s,q as I,A as y,N as M,t as d,v as N,Y as L,z as k,c as b,ae as S,af as j,E as O}from"./vendor-620ca2c7.js";import{_ as U,a as V}from"./index-d1738460.js";import{E as q,i as Q}from"./icons-e1fab587.js";const W={class:"plugin-details__header"},Y={class:"plugin-details__content"},F={key:0,class:"readme-loading"},J={key:1,class:"readme-error"},K=["innerHTML"],X={class:"plugin-details__footer"},Z={__name:"PluginDetails",props:{show:Boolean,plugin:Object},emits:["update:show"],setup(l,{emit:R}){const c=l,z=R,u=m(c.show),v=m(!1),h=m(!1),x=m(""),$=V();C($),D(()=>c.show,o=>{u.value=o}),D(u,o=>{z("update:show",o),o&&A()});const T=o=>{o&&window.open(o,"_blank")};async function A(){var o;if((o=c.plugin)!=null&&o.repo){v.value=!0,h.value=!1;try{const[e,r]=c.plugin.repo.split("/").slice(-2);let i="";try{const n=await fetch(`https://api.github.com/repos/${e}/${r}/readme`,{method:"GET",headers:{Accept:"application/vnd.github.v3.raw"},timeout:1e4});if(n.ok)i=await n.text();else throw new Error(`GitHub API /readme returned ${n.status}`)}catch{const f=["main","master"],p=["README.md","Readme.md","readme.md","README.MD","README"];let g=!1;for(const P of f){for(const B of p)try{const w=await fetch(`https://github.wenturc.com/${e}/${r}/${P}/${B}`,{method:"GET",headers:{Accept:"text/plain"},timeout:1e4});if(w.ok){i=await w.text(),g=!0;break}}catch{}if(g)break}if(!g)throw new Error("无法获取 README（API 与镜像均失败）")}if(!i)throw new Error("README 内容为空");x.value=H(i)}catch(e){console.error("Error fetching README:",e),h.value=!0}finally{v.value=!1}}}return(o,e)=>(_(),G(s(O),{show:u.value,"onUpdate:show":e[2]||(e[2]=r=>u.value=r),"mask-closable":!0,preset:"card",class:"plugin-details",style:{"max-width":"900px",width:"90%"},bordered:!1},{header:t(()=>[E("div",W,[a(s(I),{class:"plugin-details__title"},{default:t(()=>[a(s(y),{align:"center",size:12},{default:t(()=>{var r;return[a(s(M),{size:"24"},{default:t(()=>[a(s(q))]),_:1}),d(" "+N((r=l.plugin)==null?void 0:r.name)+" ",1),a(s(L),{type:"success",size:"small",bordered:!1},{default:t(()=>{var i,n,f,p;return[d(N((n=(i=l.plugin)==null?void 0:i.version)!=null&&n.startsWith("v")?(f=l.plugin)==null?void 0:f.version:"v"+((p=l.plugin)==null?void 0:p.version)),1)]}),_:1})]}),_:1})]),_:1})])]),footer:t(()=>[E("div",X,[a(s(y),{justify:"end",size:12},{default:t(()=>[a(s(k),{secondary:"",type:"primary",onClick:e[0]||(e[0]=r=>{var i;return T((i=l.plugin)==null?void 0:i.repo)})},{icon:t(()=>[a(s(M),null,{default:t(()=>[a(s(Q))]),_:1})]),default:t(()=>[e[5]||(e[5]=d(" 查看仓库 ",-1))]),_:1,__:[5]}),a(s(k),{type:"primary",onClick:e[1]||(e[1]=r=>u.value=!1)},{default:t(()=>e[6]||(e[6]=[d(" 关闭 ",-1)])),_:1,__:[6]})]),_:1})])]),default:t(()=>[E("div",Y,[a(s(y),{vertical:"",size:"large"},{default:t(()=>[v.value?(_(),b("div",F,[a(s(S),{size:"medium"},{description:t(()=>e[3]||(e[3]=[d(" 正在加载 README... ",-1)])),_:1})])):h.value?(_(),b("div",J,[a(s(j),{description:"加载 README 失败"},{extra:t(()=>[a(s(k),{size:"small",onClick:A},{default:t(()=>e[4]||(e[4]=[d(" 重试 ",-1)])),_:1,__:[4]})]),_:1})])):(_(),b("div",{key:2,class:"markdown-content",innerHTML:x.value},null,8,K))]),_:1})])]),_:1},8,["show"]))}},oe=U(Z,[["__scopeId","data-v-17b64fd8"]]);export{oe as default};
