import{d as B}from"./markdown-75d73743.js";import{g as _,w as E,G as L,n as O,o as g,c as w,a as h,L as q,Q as M,k as a,j as i,u as s,q as H,A as R,N as z,t as f,v as C,X as j,z as x,ad as U,ae as V,R as W,E as Q}from"./vendor-6e161c91.js";import{_ as P,a as X}from"./index-6166b163.js";import{E as F,f as J}from"./icons-889b0855.js";const K={class:"plugin-comment"},Y={__name:"PluginComment",props:{repo:{type:String,required:!0},theme:{type:String,default:"light"},pluginName:{type:String,required:!0}},setup(o){const m=o,d=_(null);function v(){if(!d.value)return;const l=d.value.querySelector("iframe");l&&l.remove();const e=document.createElement("script");e.src="https://giscus.app/client.js",e.setAttribute("data-repo","IGCrystal-NEO/Astrbot_Plugins_Market"),e.setAttribute("data-repo-id","R_kgDOPRLyzg"),e.setAttribute("data-category","Ideas"),e.setAttribute("data-category-id","DIC_kwDOPRLyzs4CthUw"),e.setAttribute("data-mapping","specific"),e.setAttribute("data-term",`plugin:${m.pluginName}`),e.setAttribute("data-strict","1"),e.setAttribute("data-reactions-enabled","1"),e.setAttribute("data-emit-metadata","0"),e.setAttribute("data-input-position","bottom"),e.setAttribute("data-theme",m.theme==="dark"?"dark_tritanopia":"light_tritanopia"),e.setAttribute("data-lang","zh-CN"),e.setAttribute("data-loading","lazy"),e.crossOrigin="anonymous",e.async=!0,d.value.appendChild(e)}E(()=>m.theme,()=>{v()});const c=l=>{const e=document.querySelector(".giscus-frame");e&&e.contentWindow.postMessage({giscus:{setConfig:{theme:l==="dark"?"dark_tritanopia":"light_tritanopia"}}},"https://giscus.app")};return L(()=>{v()}),E(()=>m.theme,l=>{O(()=>{c(l)})},{immediate:!1}),(l,e)=>(g(),w("div",K,[e[0]||(e[0]=h("div",{class:"plugin-comment__header"},null,-1)),h("div",{class:"giscus",ref_key:"giscusRef",ref:d},null,512)]))}},Z=P(Y,[["__scopeId","data-v-39203d0b"]]);const ee={class:"plugin-details__header"},te={class:"plugin-details__content"},ae={key:0,class:"readme-loading"},se={key:1,class:"readme-error"},ie=["innerHTML"],ne={class:"plugin-details__footer"},re={__name:"PluginDetails",props:{show:Boolean,plugin:Object},emits:["update:show"],setup(o,{emit:m}){const d=o,v=m,c=_(d.show),l=_(!1),e=_(!1),D=_(""),$=X(),{isDarkMode:T}=q($);E(()=>d.show,u=>{c.value=u}),E(c,u=>{v("update:show",u),u&&N()});const S=u=>{u&&window.open(u,"_blank")};async function N(){var u;if((u=d.plugin)!=null&&u.repo){l.value=!0,e.value=!1;try{const[t,r]=d.plugin.repo.split("/").slice(-2);let n="";try{const p=await fetch(`https://api.github.com/repos/${t}/${r}/readme`,{method:"GET",headers:{Accept:"application/vnd.github.v3.raw"},timeout:1e4});if(p.ok)n=await p.text();else throw new Error(`GitHub API /readme returned ${p.status}`)}catch{const y=["main","master"],b=["README.md","Readme.md","readme.md","README.MD","README"];let k=!1;for(const G of y){for(const I of b)try{const A=await fetch(`https://github.wenturc.com/${t}/${r}/${G}/${I}`,{method:"GET",headers:{Accept:"text/plain"},timeout:1e4});if(A.ok){n=await A.text(),k=!0;break}}catch{}if(k)break}if(!k)throw new Error("无法获取 README（API 与镜像均失败）")}if(!n)throw new Error("README 内容为空");D.value=B(n)}catch(t){console.error("Error fetching README:",t),e.value=!0}finally{l.value=!1}}}return(u,t)=>(g(),M(s(Q),{show:c.value,"onUpdate:show":t[2]||(t[2]=r=>c.value=r),"mask-closable":!0,preset:"card",class:"plugin-details",style:{"max-width":"900px",width:"90%"},bordered:!1},{header:a(()=>[h("div",ee,[i(s(H),{class:"plugin-details__title"},{default:a(()=>[i(s(R),{align:"center",size:12},{default:a(()=>{var r;return[i(s(z),{size:"24"},{default:a(()=>[i(s(F))]),_:1}),f(" "+C((r=o.plugin)==null?void 0:r.name)+" ",1),i(s(j),{type:"success",size:"small",bordered:!1},{default:a(()=>{var n,p,y,b;return[f(C((p=(n=o.plugin)==null?void 0:n.version)!=null&&p.startsWith("v")?(y=o.plugin)==null?void 0:y.version:"v"+((b=o.plugin)==null?void 0:b.version)),1)]}),_:1})]}),_:1})]),_:1})])]),footer:a(()=>[h("div",ne,[i(s(R),{justify:"end",size:12},{default:a(()=>[i(s(x),{secondary:"",type:"primary",onClick:t[0]||(t[0]=r=>{var n;return S((n=o.plugin)==null?void 0:n.repo)})},{icon:a(()=>[i(s(z),null,{default:a(()=>[i(s(J))]),_:1})]),default:a(()=>[t[5]||(t[5]=f(" 查看仓库 ",-1))]),_:1,__:[5]}),i(s(x),{type:"primary",onClick:t[1]||(t[1]=r=>c.value=!1)},{default:a(()=>t[6]||(t[6]=[f(" 关闭 ",-1)])),_:1,__:[6]})]),_:1})])]),default:a(()=>[h("div",te,[i(s(R),{vertical:"",size:"large"},{default:a(()=>{var r,n;return[l.value?(g(),w("div",ae,[i(s(U),{size:"medium"},{description:a(()=>t[3]||(t[3]=[f(" 正在加载 README... ",-1)])),_:1})])):e.value?(g(),w("div",se,[i(s(V),{description:"加载 README 失败"},{extra:a(()=>[i(s(x),{size:"small",onClick:N},{default:a(()=>t[4]||(t[4]=[f(" 重试 ",-1)])),_:1,__:[4]})]),_:1})])):(g(),w("div",{key:2,class:"markdown-content",innerHTML:D.value},null,8,ie)),(r=o.plugin)!=null&&r.repo?(g(),M(Z,{key:3,repo:o.plugin.repo,theme:s(T)?"dark":"light","plugin-name":(n=o.plugin)==null?void 0:n.name},null,8,["repo","theme","plugin-name"])):W("",!0)]}),_:1})])]),_:1},8,["show"]))}},ce=P(re,[["__scopeId","data-v-b858796d"]]);export{ce as default};
